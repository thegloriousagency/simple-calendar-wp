const n=window.CECCalendarSettings||{},i=(e={})=>{const t=new URL(n.restUrl);return Object.entries(e).forEach(([a,r])=>{r!=null&&t.searchParams.append(a,r)}),t.toString()},h=async e=>{const t=await fetch(i(e),{headers:{"X-WP-Nonce":n.nonce||""},credentials:"same-origin"});if(!t.ok)throw new Error("Unable to load calendar data");return t.json()},u=(e,t)=>{const a=document.createElement("div");a.innerHTML=t;const r=a.querySelector("[data-cec-calendar]");if(!r)throw new Error("Calendar HTML missing data attribute.");e.replaceWith(r),o(r)},d=async(e,t)=>{e.classList.add("is-loading");try{const a=await h(t);u(e,a.html)}catch(a){console.error("Church Events Calendar:",a),e.classList.remove("is-loading")}},g=(e,t)=>{const a=e.target.closest("[data-cec-nav]");if(!a)return;e.preventDefault();const r=a.dataset.cecNav;let s=parseInt(t.dataset.cecYear,10),c=parseInt(t.dataset.cecMonth,10);const l=t.dataset.cecCategory||"";r==="today"&&n.today?(s=parseInt(n.today.year,10),c=parseInt(n.today.month,10)):(s=parseInt(a.dataset.targetYear||s,10),c=parseInt(a.dataset.targetMonth||c,10)),d(t,{year:s,month:c,category:l})},p=(e,t)=>{const a=e.target.closest("[data-cec-filter]");if(!a)return;const r=a.value||"";d(t,{year:parseInt(t.dataset.cecYear,10),month:parseInt(t.dataset.cecMonth,10),category:r})};function o(e){!e||e.dataset.cecInitialized||(e.dataset.cecInitialized="true",e.addEventListener("click",t=>g(t,e)),e.addEventListener("change",t=>p(t,e)))}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-cec-calendar]").forEach(e=>o(e))});
