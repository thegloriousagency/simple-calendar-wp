const d=window.CECCalendarSettings||{},g=(t={})=>{const e=new URL(d.restUrl);return Object.entries(t).forEach(([a,n])=>{n!=null&&e.searchParams.append(a,n)}),e.toString()},u=async t=>{const e=await fetch(g(t),{headers:{"X-WP-Nonce":d.nonce||""},credentials:"same-origin"});if(!e.ok)throw new Error("Unable to load calendar data");return e.json()},w=(t,e)=>{const a=document.createElement("div");a.innerHTML=e;const n=a.querySelector("[data-cec-calendar]");if(!n)throw new Error("Calendar HTML missing data attribute.");t.replaceWith(n),i(n)},l=async(t,e)=>{t.classList.add("is-loading");try{window.console&&typeof window.console.debug=="function"&&window.console.debug("[CEC] Updating calendar",e);const a=await u(e);w(t,a.html)}catch(a){console.error("Church Events Calendar:",a),t.classList.remove("is-loading")}},h=(t,e)=>{const a=t.target.closest("[data-cec-nav]");if(!a)return;t.preventDefault();const n=a.dataset.cecNav;let o=parseInt(e.dataset.cecYear,10),s=parseInt(e.dataset.cecMonth,10);const c=e.dataset.cecCategory||"",r=e.dataset.cecLanguage||"";window.console&&typeof window.console.debug=="function"&&window.console.debug("[CEC] Navigation request",{action:n,year:o,month:s,category:c,language:r,targetYear:a.dataset.targetYear,targetMonth:a.dataset.targetMonth}),n==="today"&&d.today?(o=parseInt(d.today.year,10),s=parseInt(d.today.month,10)):(o=parseInt(a.dataset.targetYear||o,10),s=parseInt(a.dataset.targetMonth||s,10)),l(e,{year:o,month:s,category:c,lang:r||void 0})},f=(t,e)=>{const a=t.target.closest("[data-cec-filter]");if(!a)return;const n=a.value||"",o=e.dataset.cecLanguage||"";window.console&&typeof window.console.debug=="function"&&window.console.debug("[CEC] Filter change",{category:n,language:o}),l(e,{year:parseInt(e.dataset.cecYear,10),month:parseInt(e.dataset.cecMonth,10),category:n,lang:o||void 0})};function i(t){!t||t.dataset.cecInitialized||(t.dataset.cecInitialized="true",t.addEventListener("click",e=>h(e,t)),t.addEventListener("change",e=>f(e,t)))}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-cec-calendar]").forEach(t=>i(t))});
